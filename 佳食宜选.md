# 餐饮下单系统

## 一、引言

### 1.1 项目背景

当前餐饮行业进入个性化服务升级阶段，用户对饮食推荐的精准度、订单流程的便捷性及社交互动的协同性提出更高要求。然而市场现存产品普遍存在推荐同质化严重、订单管理流程繁琐、用户与商家协同效率低下等问题。为此，亟需开发一款整合个性化推荐、全链路订单管理、双角色协同及社交互动功能的餐饮系统，以提升用户饮食决策效率与商家运营管理效能。

### 1.2 产品目标

1. 为用户提供场景化个性化饮食推荐，降低饮食决策成本，实现卡路里精准管控；

2. 覆盖“选菜-定制-支付-追踪-评价”全订单链路，满足用户个性化需求与操作可追溯性；

3. 明确用户与商家双角色权责边界，实现订单流程透明化与高效协同；

4. 整合外部内容资源与社交互动功能，提升用户粘性与商家运营灵活性。

### 1.3 范围定义

- **包含功能**：个性化饮食推荐、卡路里管理、菜品定制、订单全流程追踪、双角色权限管理、社交聊天与订单协同、用户共创与商家运营工具等；

- **排除功能**：线下门店收银系统、供应链仓储管理、第三方配送调度（仅集成配送状态查询接口）。

## 二、功能需求

### 2.1 个性化饮食推荐与日常管理模块

#### 2.1.1 定位与天气智能推荐

- 支持GPS自动定位（定位误差超过500米时弹窗提示用户确认）及手动选择城市/商圈；

- 推荐逻辑融合天气与时间双维度：天气维度（如温度＞30℃优先推荐冰饮/凉菜，湿度＞80%推荐祛湿粥品），时间维度（早餐侧重热饮+碳水组合，夜宵主推轻食类）；

- 提供“关闭天气推荐”开关，关闭后切换为“地理位置+历史偏好”纯个性化推荐模式；

- 记录用户推荐拒绝行为（如累计3次拒绝“甜口菜品”推荐），后续自动降低同类推荐权重。

#### 2.1.2 卡路里精准管理与饮食趋势

- 用户首次注册时，引导填写身高、体重、饮食目标等身体数据，系统自动计算每日卡路里建议摄入量（精确到克级）；

- 选菜过程中实时展示当日剩余可摄入卡路里（示例：“今日还可摄入350大卡”），点击菜品可查看食材级卡路里明细；

- 自动生成周/月卡路里摄入趋势图，明确标注“超标日”及当日对应菜品。

#### 2.1.3 日历场景化饮食推荐

- 结合节气/节日自动推送特色菜品（如立秋推荐“贴秋膘套餐”，端午主推粽子相关搭配）；

- 支持用户自定义饮食事件（如“每月15号素食日”），日历视图同步生成“饮食禁忌热力图”；

- 节日前3天推送专属菜单，支持一键分享至社交渠道及生成订单草稿。

### 2.2 菜品定制与订单全链路管理模块

#### 2.2.1 菜品口味与备注精细化

- 口味选项采用“标准化标签+自由输入”组合模式（示例：预设“微辣/中辣/免辣”标签，搭配文字备注“辣度参考XX品牌火锅中辣”）；

- 备注冲突智能提示：若用户备注“免辣”但所选菜品含辣椒成分，下单时弹窗提示冲突并引导调整；

- 商家端备注优先级分级展示：过敏食材提示（红色高亮）＞核心需求（黄色高亮）＞口味调整，实现差异化识别。

#### 2.2.2 食材与烹饪方式灵活配置

- 支持菜品DIY配置：系统自动勾选必选食材（不可取消），非必选食材可自由增减，营养数据实时同步更新；

- 食材兼容性风险校验：若检测到高风险食材组合（如“海鲜+大量维生素C食材”），即时弹窗提示潜在风险。

#### 2.2.3 订单留言与操作追溯

- 支持订单级与菜品级双重留言（示例：订单级备注“整体减盐”，单菜品备注“少放花生”）；

- 订单被商家接单后，系统自动创建用户与商家的专属聊天会话（无历史会话时），并同步订单核心信息；

- 留言状态可视化：发送方可实时查看留言“已读/未读”状态，未读消息触发接收方APP震动+铃声提醒；商家回复支持图片上传。

#### 2.2.4 “再来一单”智能复购

- 复制历史订单时自动处理异常：
    - 下架菜品：替换为相似品并提示，无相似品则提示缺货；
    - 价格变动：显示原价与现价（如“原18元，现价20元（猪肉涨价）”），涨价菜品红色标注并显示涨幅；
- 复制历史订单时自动识别并处理异常场景：
- 菜品下架：自动替换为相似菜品并提示，无相似菜品时明确提示“该菜品已缺货”；
- 价格变动：同步展示原价与现价（示例：“原18元，现价20元（因猪肉涨价调整）”），涨价菜品以红色标注并显示涨幅；
- 自动继承原订单个性化设置（含备注、配送地址等信息）。

### 2.3 双角色协同与订单流程追踪模块

#### 2.3.1 双角色权限分级

- **下单用户**：拥有菜单查看、需求备注、订单步骤追踪、评价反馈等权限；
- **接单商家**：需完成商户认证及支付账户登记，支持多菜单管理，核心功能包括订单接收、菜品进度更新、库存查询、菜单设置、“想吃列表”审核。

#### 2.3.2 订单步骤全流程管理

- 操作灵活性：
    - 支持批量标记（如勾选3道菜一键标记“备菜完成”）；
    - 支持状态回退（如“烹饪”回退至“预处理”需填写原因并确认）；
- 进度可视化：
    - 用户端：查看每个菜品的步骤进度；
    - 商家端：TODO列表支持筛选（如“待备菜”），可拖拽排序（优先处理耗时长的菜品）；
- 菜品步骤标准化配置：默认5步流程（备菜→预处理→烹饪→摆盘→上菜），快餐类支持简化为“制作→打包→出餐”，并提供模板化新增功能；
- 订单状态：（备菜中->烹饪制作中->菜品上齐待确认->订单已完成）不涉及配送服务。
- 完成确认机制：所有菜品进入“上菜”阶段后，用户端触发弹窗+短信双重通知，用户点击确认后自动展示评价入口；商家需在48小时内回复用户评价。

### 2.4 外部内容整合与社交互动模块

#### 2.4.1 视频/文章内容提取与复用

- 视频内容提取：通过OCR字幕识别+AI画面分析，自动提取菜品详情（含主料、辅料、制作步骤、难度等级、耗时）；

- 文章内容提取：通过NLP技术抓取核心关键词（示例：“主料：排骨，烹饪方式：炖”）；

- 用户可修正提取结果并保存为“我的私藏食谱”，系统自动标注内容来源以规避版权风险。

#### 2.4.2 社交聊天与订单协同

- **单聊模式**：

	- 仅接单方为商户，商户可发送自己店铺的结构化菜单（含菜品名称+规格数量）给下单用户，接收方点击菜单可直接跳转至下单页面；
	
	- 系统自动核算订单预估总价，聊天记录支持按商家/店铺筛选，同时提供消息置顶与删除功能；
	
	- 角色切换规则：若下单用户发送自己店铺的菜单给商户，商户可查看；若下单会跳转至角色互换的新会话（原下单用户→商户，原商户→下单用户）。

- **群聊模式**：

	- 发起者邀请成员并指定合作商家后，群内成员可直接点单或追加菜品，支持“统一提交后集中支付”与“个人菜品单独支付”两种模式；
	
	- 实时展示已点菜品汇总列表（示例：“宫保鸡丁：3份”），点单次数≥3次的高频重复菜品以黄色高亮提示，减少无效重复点单；
	
	- 多元化支付功能：涵盖“各付各的”“AA自动拆分”（选定参与人员后系统自动核算金额）、“自定义分摊”（示例：“用户A多承担20%”）及“代付”（支持添加代付备注说明）；
	
	- 灵活加菜机制
		- 原订单未完成时支持发起加菜操作，加菜界面需同步展示核心信息：已点菜品清单、累计金额、群内成员饮食禁忌（如 “2 人免香菜”）及当前订单制作进度（如 “备菜中”），避免重复加菜或禁忌冲突。
		- 加菜权限默认设为 “全员可加菜”，发起者可在群订单设置中切换为 “仅发起者可加菜”（适配商务聚餐等需统一管控的场景），所有加菜菜品均以 “【加购】” 为前缀标注，系统自动向群内全员推送加菜提醒（示例：“XX 用户发起加菜：【加购】宫保鸡丁 1 份”），确保信息透明。
	
	- **分支付模式的加菜流程**：
	
	1. 若选择“统一提交后集中支付”：
	
		- 多请求集中展示：发起者端将同步生成“加菜审核清单”（桌面端置于订单详情页侧边栏，小程序端点击弹窗入口打开），清单按“加菜提交时间”倒序排列，每条请求清晰标注加菜人、菜品名称、数量、提交时间及是否符合群内饮食禁忌（禁忌冲突项标红提醒），支持发起者“全选/单选”批量处理；
	    
		- 审核流程：发起者可对单条/多条请求点击“通过”或“驳回”，驳回时需选择预设原因（如“超出聚餐预算”“菜品已备齐”）并补充说明；审核通过后，加菜订单将“关联至原订单但独立为待支付状态”，而非直接合并已支付的原订单，菜品名称下方标注“加菜人：XX｜待支付”；
	    
		- 撤回与超时规则：发起者未审核前，加菜用户可随时撤回申请，撤回后菜品回归个人待点清单；若发起者10分钟内未处理，系统将推送二次提醒，超15分钟未处理则自动驳回，同时告知加菜用户“发起者超时未审核，申请已驳回”；
	    
		- 统一支付环节：所有审核通过的加菜订单，将汇总至“待支付加菜池”，与原订单在统一支付界面关联展示（标注“原订单#XXX关联加菜”），合并计算总金额，由发起者完成支付后，整体同步至商家端。
	    
	
	2. 若选择“个人菜品单独支付”：
	    
	    - 加菜无需经过发起者审核，提交后直接同步至商家端，加菜订单与原订单关联展示（商家端标注“【加购】”前缀），待商家接单后独立处理。
	
	- 订单记录追溯：系统自动记录每道菜品的下单人及支付人信息，订单完成后生成结构化“群订单档案”，支持明细导出供核对；
	
	- 消息管理规则：支持设置群聊勿扰模式及自定义提醒类型（如仅接收“出餐通知”等关键信息）；未支付的订单菜品需在十五分钟内完成支付，不然订单将自动取消，支付成功后，订单发送给商家，商家接单后开始制作，已支付菜品仅支持发起修改申请，需经商家确认后方可生效；
	
	- 群与商家联系机制：采用“群发起者与商家创建群订单专属会话”模式，不建议将商家直接拉入群聊，具体规则如下：
	
	- 商家不入群的核心原因：一是保障群内成员点单偏好、支付记录等隐私信息安全；二是避免群内闲聊信息干扰商家抓取订单关键需求；三是防止商家推送运营信息打扰群聊氛围，维持协同效率；
	
	- 专属会话核心属性：群订单首次提交并被商家接单后，系统自动创建会话，会话名称标注为“【群订单】XXX群-XX商家”以明确场景；仅群发起者拥有与商家的双向沟通权限，其他群成员无查看及发言权限，避免协商细节（如临时菜品调整、出餐延迟交涉等）过度暴露；会话内默认置顶群订单核心信息（订单号、已点菜品汇总、支付方式），便于发起者快速核对；
	
	- 会话独立性规则：该专属会话与发起者个人的商家聊天会话相互独立，不做合并处理——二者分别承载群订单与个人订单的沟通内容，有效避免订单追溯时出现信息混淆；
	
	- 配套“一键同步”功能：以“操作极简、信息精准”为设计核心，具体规则如下：
	
	- 核心触发入口：简化为两类高频场景，避免操作分散——① 商家发送消息后，该消息右侧自动显示“同步到群”按钮，并高亮提示3秒以吸引发起者注意；② 长按单条消息或勾选多条消息（支持批量操作）时，弹出菜单直接显示“同步至XX群”选项（XX为对应群聊名称，**不支持手动切换目标群聊** ）；
	
	- 极简操作流程：发起者点击同步入口后，系统自动提炼消息关键信息（如“出餐进度”“食材替换通知”等）并匹配对应标签，生成“【订单同步】+标签+消息内容”的预览界面；发起者无需手动修改，点击“确认”即可完成同步；同步成功后，消息旁标记“已同步”标识，并向发起者推送轻量提示；
	
	- 展示与关联规则：① 群聊内同步内容以标红前缀“【订单同步】”开头，点击消息可直接跳转至群订单详情页；② 群聊与专属会话间设置一键跳转入口，便于发起者快速切换操作；③ 群订单完成后，专属会话自动归档至“群订单历史”文件夹，同步记录随会话一同保存，支持后续追溯；
	
	- 关键异常处理：聚焦核心异常场景——① 网络中断导致同步失败时，弹窗提示“同步失败，点击重试”；② 群聊已解散或发起者被移出群聊时，提示“群聊不可用”并同步引导发起者检查群聊状态。

### 2.5 用户共创与商家运营工具模块

#### 2.5.1 “想吃列表”审核与共创

- 用户可上传菜品需求（含图片、名称、口味要求）或关联“我的食谱”，商家需在24小时内完成审核（超时未审核则自动通过）；

- 商家拒绝需求时，需选择预设拒绝原因（如“食材季节性短缺”）并补充自定义说明；用户对拒绝结果有异议可发起申诉并重新提交，商家需在12小时内回复申诉。

#### 2.5.2 商家运营工具包

- 菜单管理功能：支持设置“招牌菜”“推荐菜”“季节限定”等标签，精准标注菜品辣度、核心食材、烹饪时长，同时支持商家自定义商品标签。

## 三、非功能需求

### 3.1 性能需求

- 页面响应时间≤2秒，订单状态更新延迟≤5秒；

- 支持至少1000名用户同时在线操作，群聊订单并发处理能力≥100组/分钟。

### 3.2 安全性需求

- 用户核心数据（身体数据、支付信息等）采用加密存储，完全符合国家数据安全标准；

- 支付流程以平台币为核心操作载体，预留支付宝/微信支付接口位置但暂不实现，参考主流支付平台加密流程设计，保障支付信息安全；

- 商家入驻需完成多维度资质校验（含营业执照、法人身份信息等），有效防范虚假商户入驻。

### 3.3 易用性需求

- 操作反馈机制：所有交互动作（点击、滑动等）需配置动画提示（示例：勾选食材时的打钩动画）；

- 离线支持能力：定位、天气、常用菜品信息支持本地缓存，弱网环境下可正常浏览基础内容；

- 无障碍设计：支持字体放大、订单详情语音朗读功能，适配视障及老年用户使用需求。

### 3.4 兼容性需求

- 支持iOS 12.0及以上、Android 8.0及以上版本移动设备，适配屏幕尺寸范围4.7-6.7英寸；

- 预留微信支付、支付宝支付接口位置（暂不实现），核心支付操作通过平台币完成。

## 四、系统接口需求

1. 地图服务接口：集成高德/百度地图API，实现定位功能；

2. 天气服务接口：接入第三方天气API，获取温度、湿度、PM2.5等气象数据；

3. 支付接口：预留微信支付、支付宝支付对接接口，核心使用平台币结算系统；

4. 消息推送接口：集成短信服务商API，实现订单状态短信通知功能。

## 五、运营与维护需求

1. 数据备份机制：用户订单、食谱等核心数据每日自动备份，历史记录保留30天；

2. 系统监控能力：实时监控服务器负载、接口响应状态，出现异常时触发自动报警；

3. 版本迭代支持：支持功能模块灰度发布，具备完整的版本回滚机制。

## 六、附则

本需求说明书将根据业务发展需求动态更新，其最终解释权归产品团队所有。